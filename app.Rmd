---
title: "Explore Business Dynamism in the 50 States "
output: 
  flexdashboard::flex_dashboard
    theme: spacelab
    orientation: rows
    source_code: embed
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(shiny)
library(ggplot2)
library(DT)
library(stringr)
library(dplyr)
library(tools)
library(plotly)

# Load file
busdyn <- read.csv(file = "BDS_Data_04_18.csv", fileEncoding="UTF-8-BOM")

# Remove Underscores in Column and Row Names
gsub(x = names(busdyn), pattern = "_", replacement = " ") 

```
Inputs {.sidebar}
-----------------------------------------------------------------------
```{r setup, include=FALSE}
# User selects which state(s) to graph------------------------------------------
checkboxGroupInput("state", "State(s)", choices = c("State"),
                  selected = 2018, inline = TRUE
                  )

# User selects which year(s) to graph-------------------------------------------
sliderInput("year", "Year(s)",
            min = min(busdyn$Year), max = max(busdyn$Year),
            value = range(busdyn$Year)
            )

# User selects first metric to graph---------------------------------------------
radioButtons("metric1", "First Metric", choices = colnames(busdyn[3:11]), selected = NULL)

# User selects second metric to graph---------------------------------------------
radioButtons("metric2", "Second Metric", choices = colnames(busdyn[3:11]), selected = NULL)

# User can request a data table
```
Outputs
Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r}
# Create subset of dataset based on user inputs
busdyn_subset <- reactive({
  req(input$state, input$year, input$metric) #ensure user has chosen what to graph
  busdyn %>%
      filter(
      State == input$state,
      Year == input$year) %>%
    select(State, Year, input$metric1, input$metric2)
    
})

# Create scatterplot of data subset
renderPlot({
ggplotly(ggplot(busdyn_subset(), aes(x = input$metric1,
                            y = input$metric2)) + 
         geom_point(aes(col = State)) +
         labs(y = input$metric2,
              x = input$metric1,
              title="The Best Performing States",
              caption="Source: U.S. Census Business Dynamics Statistics Survey"),
         tooltip=c("x", "y")
)
})

```

Column {data-width=350}
-----------------------------------------------------------------------

### Value Boxes

```{r}
# Value Box showing average value of first metric graphed
renderValueBox({
valueBox(value = mean(busdyn_subset() %>% input$metric1),
         subtitle = "average value") 
  })

# Value Box showing average value of second metric graphed
renderValueBox({
valueBox(value = mean(busdyn_subset() %>% input$metric2),
         subtitle = "average value")
})


```

### Data Table

```{r}
# Data Table corresponding to scatterplot
reactive({DT::datatable(busdyn_subset(), 
          class = "cell-border stripe",
          caption = "Table of user-subsetted data",
          )
})
```

